; Mapeamento hardware
RS EQU P1.3 ; Reg Select em P1.3
EN EQU P1.2 ; Enable em P1.2

ORG 00H
LJMP START
; senha padrao 4 3 2 1 0
ORG 50H
SENHA:
	;DB 52, 51, 50, 49, 48, 0
	DB "43210"
	DB 0
; senha tentativa
ORG 60H
TENTATIVA:
	DB "43210"
	DB 0
;
ORG 200H
START:

MAIN:
;ACALL LCD_INIT
ACALL FECHA
SJMP $
MOV R7, #03H ; numero de tentativas

CHECASENHA:
MOV R6, #05H
MOV R1, #60H
MOV DPTR, #SENHA
PROXCHAR:
CLR A
MOVC A,@A+DPTR
XRL A, @R1 ; 0 se forem iguais
JNZ ERROU
DEC R7

ERROU:
	JMP $

LCD_INIT:
	CLR RS
	CLR P1.7
	CLR P1.6
	SETB P1.5
	CLR P1.4
	SETB EN
	CLR EN
	CALL DELAY50	

	SETB EN
	CLR EN
	SETB P1.7
	SETB EN
	CLR EN
	CALL DELAY50

	CLR P1.7
	CLR P1.6
	CLR P1.5
	CLR P1.4
	SETB EN
	CLR EN
	SETB P1.6
	SETB P1.5
	SETB EN
	CLR EN
	CALL DELAY50

	CLR P1.7
	CLR P1.6
	CLR P1.5
	CLR P1.4
	SETB EN
	CLR EN
	SETB P1.7
	SETB P1.6
	SETB P1.5
	SETB P1.4
	SETB EN
	CLR EN
	CALL DELAY50
	RET

ABRE:
CLR P3.0
SETB P3.1
CALL DELAYMOTOR
CLR P3.1

FECHA:
SETB P3.0
CLR P3.1
CALL DELAYMOTOR
CLR P3.0

DELAY50:
	MOV R0, #50
	DJNZ R0, $
	RET

DELAYMOTOR:
	MOV R0, #13 ; Delay para fechar
	DJNZ R0, $
	RET